<!doctype html>
<html lang="el">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>PE Simulation Demo â€” Problem â€¢ Space â€¢ Rules (LLM-free)</title>
  <style>
    :root{
      --bg:#0b1020; --card:#121a33; --card2:#0f1730; --text:#eaf0ff; --muted:#b7c2ff;
      --ok:#46f2a1; --warn:#ffd166; --bad:#ff5c7a; --line:rgba(255,255,255,.10);
      --btn:#22305f; --btn2:#1a2550;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
    }
    body{margin:0; font-family:var(--sans); background:radial-gradient(1200px 700px at 20% 0%, #1a2a66 0%, var(--bg) 55%); color:var(--text);}
    header{padding:18px 16px; border-bottom:1px solid var(--line); background:rgba(0,0,0,.10); backdrop-filter: blur(6px);}
    h1{margin:0; font-size:18px; font-weight:700;}
    .sub{margin-top:6px; color:var(--muted); font-size:13px; line-height:1.35;}
    main{max-width:1040px; margin:0 auto; padding:16px;}
    .grid{display:grid; grid-template-columns: 330px 1fr; gap:14px;}
    .card{background:linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.02)); border:1px solid var(--line); border-radius:14px; padding:14px;}
    .card h2{margin:0 0 8px 0; font-size:14px;}
    .muted{color:var(--muted); font-size:13px; line-height:1.4;}
    label{display:block; font-size:12px; color:var(--muted); margin:10px 0 6px;}
    select, input, textarea{
      width:100%; box-sizing:border-box; padding:10px 10px; border-radius:10px;
      border:1px solid var(--line); background:rgba(0,0,0,.18); color:var(--text);
      outline:none;
    }
    textarea{min-height:110px; resize:vertical; line-height:1.35;}
    .row{display:grid; grid-template-columns: 1fr 1fr; gap:10px;}
    .btns{display:flex; gap:10px; margin-top:10px; flex-wrap:wrap;}
    button{
      border:1px solid var(--line); background:linear-gradient(180deg, var(--btn), var(--btn2));
      color:var(--text); padding:10px 12px; border-radius:12px; font-weight:650; cursor:pointer;
    }
    button.secondary{background:rgba(0,0,0,.15); font-weight:600;}
    button:disabled{opacity:.6; cursor:not-allowed;}
    .pill{display:inline-flex; align-items:center; gap:8px; padding:6px 10px; border-radius:999px; border:1px solid var(--line); background:rgba(0,0,0,.14); font-size:12px; color:var(--muted);}
    .kpi{display:flex; gap:10px; flex-wrap:wrap; margin-top:10px;}
    .kpi .pill b{color:var(--text); font-family:var(--mono); font-weight:800;}
    .hr{height:1px; background:var(--line); margin:12px 0;}
    .answerBox{border:1px dashed var(--line); border-radius:12px; padding:12px; background:rgba(0,0,0,.12);}
    .score{font-family:var(--mono); font-weight:900; font-size:18px;}
    .tag{font-family:var(--mono); font-size:11px; padding:3px 8px; border-radius:999px; border:1px solid var(--line); background:rgba(0,0,0,.14);}
    .ok{color:var(--ok);} .warn{color:var(--warn);} .bad{color:var(--bad);}
    .small{font-size:12px; color:var(--muted); line-height:1.35;}
    .list{margin:8px 0 0 18px; color:var(--muted); font-size:13px; line-height:1.45;}
    .mono{font-family:var(--mono);}
    footer{opacity:.8; padding:18px 16px; text-align:center; color:var(--muted); font-size:12px;}
    @media (max-width: 920px){ .grid{grid-template-columns: 1fr;} }
  </style>
</head>

<body>
<header>
  <h1>Simulation Demo â€” Â«Î ÏÏŒÎ²Î»Î·Î¼Î± â€¢ Î§ÏÏÎ¿Ï‚ â€¢ ÎšÎ±Î½ÏŒÎ½ÎµÏ‚Â» (LLM-free rubric)</h1>
  <div class="sub">
    Demo Î³Î¹Î± Ï€ÏÏŒÏ„Î±ÏƒÎ· ÏƒÎµ ÏƒÏ…Î½ÎµÏÎ³Î¬Ï„ÎµÏ‚: 3 Î¬Î¾Î¿Î½ÎµÏ‚, Î¼Î¹ÎºÏÎ¬ ÏƒÎµÎ½Î¬ÏÎ¹Î±, rubric scoring, ÎºÎ±Î¹ feedback â€œÏƒÎ±Î½ LLMâ€ Ï‡Ï‰ÏÎ¯Ï‚ Ï€ÏÎ±Î³Î¼Î±Ï„Î¹ÎºÏŒ LLM.
    <span class="pill">No data from children</span>
    <span class="pill">Local only</span>
    <span class="pill">Deterministic scoring</span>
  </div>
</header>

<main>
  <div class="grid">
    <section class="card">
      <h2>Î¡Ï…Î¸Î¼Î¯ÏƒÎµÎ¹Ï‚ Î£ÎµÎ½Î±ÏÎ¯Î¿Ï…</h2>

      <label>Î†Î¾Î¿Î½Î±Ï‚ / ÎœÎ¬Î¸Î·Î¼Î±</label>
      <select id="axisSel">
        <option value="m1">1) ÎšÎ¹Î½Î·Ï„Î¹ÎºÏŒ Î ÏÏŒÎ²Î»Î·Î¼Î±</option>
        <option value="m2">2) Î§ÏÏÎ¿Ï‚ Ï‰Ï‚ Î£ÏÏƒÏ„Î·Î¼Î±</option>
        <option value="m3">3) ÎšÎ±Î½ÏŒÎ½ÎµÏ‚ & Î¡ÏŒÎ»Î¿Î¹</option>
      </select>

      <div class="row">
        <div>
          <label>Î¤Î¬Î¾Î· / Î—Î»Î¹ÎºÎ¯Î±</label>
          <select id="ageSel">
            <option value="primary">Î”Î·Î¼Î¿Ï„Î¹ÎºÏŒ</option>
            <option value="gymnasium">Î“Ï…Î¼Î½Î¬ÏƒÎ¹Î¿</option>
            <option value="lyceum">Î›ÏÎºÎµÎ¹Î¿</option>
          </select>
        </div>
        <div>
          <label>Î‘ÏÎ¹Î¸Î¼ÏŒÏ‚ Î¼Î±Î¸Î·Ï„ÏÎ½</label>
          <input id="nInput" type="number" min="8" max="30" value="22"/>
        </div>
      </div>

      <div class="row">
        <div>
          <label>Î§ÏÏÎ¿Ï‚</label>
          <select id="spaceSel">
            <option value="open_big">ÎœÎµÎ³Î¬Î»Î¿ Î±Î½Î¿Î¹Ï‡Ï„ÏŒ Ï€ÏÎ¿Î±ÏÎ»Î¹Î¿</option>
            <option value="open_small">ÎœÎ¹ÎºÏÏŒ Î±Î½Î¿Î¹Ï‡Ï„ÏŒ Ï€ÏÎ¿Î±ÏÎ»Î¹Î¿</option>
            <option value="corridor">Î£Ï„ÎµÎ½ÏŒÏ‚ Î´Î¹Î¬Î´ÏÎ¿Î¼Î¿Ï‚/Î¶ÏÎ½Î·</option>
            <option value="zoned">Î–Ï‰Î½Î¿Ï€Î¿Î¹Î·Î¼Î­Î½Î¿Ï‚ Ï‡ÏÏÎ¿Ï‚ (2â€“3 Î¶ÏÎ½ÎµÏ‚)</option>
          </select>
        </div>
        <div>
          <label>Î•Î¾Î¿Ï€Î»Î¹ÏƒÎ¼ÏŒÏ‚</label>
          <select id="equipSel">
            <option value="none">Î§Ï‰ÏÎ¯Ï‚ ÎµÎ¾Î¿Ï€Î»Î¹ÏƒÎ¼ÏŒ</option>
            <option value="one_ball">1 Î¼Ï€Î¬Î»Î±</option>
            <option value="two_balls">2 Î¼Ï€Î¬Î»ÎµÏ‚</option>
            <option value="cones">ÎšÏÎ½Î¿Î¹/ÏƒÎ·Î¼Î¬Î´Î¹Î±</option>
          </select>
        </div>
      </div>

      <label>Î ÎµÏÎ¹Î¿ÏÎ¹ÏƒÎ¼Î¿Î¯ (constraints)</label>
      <select id="constraintSel" multiple size="5">
        <option value="no_running">Î§Ï‰ÏÎ¯Ï‚ Ï„ÏÎ­Î¾Î¹Î¼Î¿</option>
        <option value="no_talking">Î§Ï‰ÏÎ¯Ï‚ Î¿Î¼Î¹Î»Î¯Î±</option>
        <option value="no_elimination">Î§Ï‰ÏÎ¯Ï‚ Î±Ï€Î¿ÎºÎ»ÎµÎ¹ÏƒÎ¼ÏŒ/â€œÎ²Î³Î±Î¯Î½Ï‰ Î­Î¾Ï‰â€</option>
        <option value="arrive_together">ÎÎ± Ï†Ï„Î¬ÏƒÎ¿Ï…Î½ ÏŒÎ»Î¿Î¹ Î¼Î±Î¶Î¯</option>
        <option value="no_leader">Î§Ï‰ÏÎ¯Ï‚ Î±ÏÏ‡Î·Î³ÏŒ/ÎµÎ½Ï„Î¿Î»Î­Ï‚</option>
      </select>
      <div class="small">Tip: ÎºÏÎ±Ï„Î¬ Ctrl/âŒ˜ Î³Î¹Î± Ï€Î¿Î»Î»Î±Ï€Î»Î® ÎµÏ€Î¹Î»Î¿Î³Î®.</div>

      <label>Î”Î¹Î´Î±ÎºÏ„Î¹ÎºÏŒÏ‚ ÏƒÏ„ÏŒÏ‡Î¿Ï‚ (Ï€.Ï‡. ÏƒÏ…Î½ÎµÏÎ³Î±ÏƒÎ¯Î±, ÏÏ…Î¸Î¼ÏŒÏ‚, Î±ÏƒÏ†Î¬Î»ÎµÎ¹Î±)</label>
      <input id="goalInput" value="ÏƒÏ…Î½ÎµÏÎ³Î±ÏƒÎ¯Î± & ÏÏÎ¸Î¼Î¹ÏƒÎ· ÏÏ…Î¸Î¼Î¿Ï"/>

      <div class="btns">
        <button id="newBtn">ÎÎ­Î¿ ÏƒÎµÎ½Î¬ÏÎ¹Î¿</button>
        <button id="hintBtn" class="secondary">Hint</button>
        <button id="resetBtn" class="secondary">Reset</button>
      </div>

      <div class="hr"></div>
      <div class="muted">
        <b>Î ÏÏ‚ â€œÎµÎ»Î­Î³Ï‡Î¿Ï…Î¼Îµ Ï„Î·Î½ Î¿ÏÎ¸ÏŒÏ„Î·Ï„Î±â€ ÎµÎ´Ï:</b><br/>
        ÎŸÎ¹ ÏƒÏ‰ÏƒÏ„Î­Ï‚/Î±Î½Î±Î¼ÎµÎ½ÏŒÎ¼ÎµÎ½ÎµÏ‚ Î±Ï€Î±Î½Ï„Î®ÏƒÎµÎ¹Ï‚ Î´ÎµÎ½ Ï€ÏÎ¿Î­ÏÏ‡Î¿Î½Ï„Î±Î¹ Î±Ï€ÏŒ Î¼Î¿Î½Ï„Î­Î»Î¿. Î ÏÎ¿Î­ÏÏ‡Î¿Î½Ï„Î±Î¹ Î±Ï€ÏŒ rubric + ÎºÎ±Î½ÏŒÎ½ÎµÏ‚ ÎµÎ»Î­Î³Ï‡Î¿Ï….
        Î¤Î¿ â€œassistantâ€ Î±Ï€Î»ÏÏ‚ ÎµÎ¾Î·Î³ÎµÎ¯ Î¼Îµ ÏƒÏ„Î±Î¸ÎµÏÏŒ Ï„ÏÏŒÏ€Î¿ Ï„Î¹ Î²ÏÎ­Î¸Î·ÎºÎµ/Ï„Î¹ Î»ÎµÎ¯Ï€ÎµÎ¹.
      </div>
    </section>

    <section class="card">
      <h2>Simulation / Î¤ÎµÏƒÏ„</h2>
      <div id="scenarioBox" class="answerBox"></div>

      <label>Î— Î±Ï€Î¬Î½Ï„Î·ÏƒÎ® ÏƒÎ¿Ï…</label>
      <textarea id="answerTA" placeholder="Î“ÏÎ¬ÏˆÎµ 3â€“6 Ï€ÏÎ¿Ï„Î¬ÏƒÎµÎ¹Ï‚."></textarea>

      <div class="btns">
        <button id="gradeBtn">Î’Î±Î¸Î¼Î¿Î»ÏŒÎ³Î·ÏƒÎ·</button>
        <button id="showRubricBtn" class="secondary">Î”ÎµÎ¯Î¾Îµ rubric</button>
      </div>

      <div class="kpi" id="kpiBox"></div>

      <div class="hr"></div>
      <div id="feedbackBox" class="answerBox"></div>
    </section>
  </div>
</main>

<footer>
 Â© 2026 Dr. Georgios Bouchouras. Educational demo for teaching simulation. All rights reserved.
</footer>

<script>
/** ---------------------------
 *  LLM-free "Evaluator Engine"
 *  - deterministic scoring based on rubric & keyword families
 *  - assistant-like feedback without any model
 * --------------------------- */

const $ = (id) => document.getElementById(id);

const KEY = {
  dominance: ["ÎºÏ…ÏÎ¹Î±ÏÏ‡", "Î¿Î¹ Î³ÏÎ®Î³Î¿ÏÎ¿Î¹", "Î¿Î¹ Î´Ï…Î½Î±Ï„Î¿", "domin", "Ï€ÏÏ‰Ï„Î±Î³Ï‰Î½Î¹ÏƒÏ„", "Î¼Î¿Î½Î¿Ï€Ï‰Î»"],
  periphery: ["Î¬ÎºÏÎ·", "Ï€ÎµÏÎ¹Î¸Ï‰Ï", "Î±Ï€Î¿ÏƒÏÏ", "Î´ÎµÎ½ ÏƒÏ…Î¼Î¼ÎµÏ„", "Î¼Î­Î½Î¿Ï…Î½ Î­Î¾Ï‰", "Ï€Î±ÏÎ±Ï„Î·Ï"],
  collisions: ["ÏƒÏÎ³ÎºÏÎ¿Ï…", "Ï‡Ï„Ï…Ï€", "ÎµÏ€Î¹ÎºÎ¯Î½Î´", "Ï‡Î±Î¿Ï‚", "Ï„ÏÎ­Ï‡Î¿Ï…Î½ Ï€Î±Î½Ï„Î¿Ï", "Î±ÏƒÏ†Î¬Î»"],
  localVision: ["Î²Î»Î­Ï€", "Î¿Ï€Ï„Î¹Îº", "ÎµÏ€Î±Ï†Î®", "ÏƒÏ…Î½Ï„Î¿Î½", "ÏÏ…Î¸Î¼", "Î¼Î±Î¶Î¯"],
  constraints: ["Ï€ÎµÏÎ¹Î¿ÏÎ¹Ïƒ", "ÎºÎ±Î½ÏŒÎ½", "Ï‡ÏÏÎ¿Ï‚", "ÏÏŒÎ»Î¿Ï‚", "Î¶ÏÎ½", "ÏŒÏÎ¹Î¿", "Î´Î¹Î±Î´ÏÎ¿Î¼"],
  noElim: ["Ï‡Ï‰ÏÎ¯Ï‚ Î±Ï€Î¿ÎºÎ»ÎµÎ¹Ïƒ", "ÎºÎ±Î½ÎµÎ¯Ï‚ Î­Î¾Ï‰", "ÎºÎ±Î½ÎµÎ¯Ï‚ Î´ÎµÎ½ Î²Î³Î±", "ÏƒÏ…Î¼Î¼ÎµÏ„Î­Ï‡Î¿Ï…Î½ ÏŒÎ»Î¿Î¹"],
  elimBad: ["Î²Î³Î±Î¯Î½ÎµÎ¹ Î­Î¾Ï‰", "Î±Ï€Î¿Î²Î¬Î»Î»", "Î±Ï€Î¿ÎºÎ»ÎµÎ¹ÏƒÎ¼", "Ï„Î¹Î¼Ï‰Ï", "ÎºÎ¬Î¸Îµ Î»Î¬Î¸Î¿Ï‚ Î­Î¾Ï‰"],
  taskAsQuestion: ["Ï€ÏÏ‚", "Î¼Îµ Ï€Î¿Î¹Î¿Î½ Ï„ÏÏŒÏ€Î¿", "Ï„Î¹ ÎºÎ±Î»Î¿ÏÎ½Ï„Î±Î¹", "Î½Î± Î»ÏÏƒÎ¿Ï…Î½", "Ï€ÏÏŒÎ²Î»Î·Î¼Î±", "ÎµÏÏÏ„Î·Î¼Î±"],
  proposeSpaceChange: ["Î¶ÏÎ½", "Î¼Î¹ÎºÏÎ±Î¯Î½", "Ï‡Ï‰ÏÎ¯Î¶", "Î´Î¹Î±Î´ÏÎ¿Î¼", "ÏƒÏ„ÎµÎ½", "ÏŒÏÎ¹Î¿", "ÏÎ¿Î®"],
  proposeRule: ["ÎºÎ±Î½ÏŒÎ½", "ÏÏŒÎ»Î¿Ï‚", "ÎµÎ½Î±Î»Î»Î±Î³", "Î´ÎµÎ½ Î¼Ï€Î¿ÏÎµÎ¯", "Ï…Ï€Î¿Ï‡ÏÎµÏ‰", "Î±Î»Î»Î¬Î¶ÎµÎ¹ ÏÏŒÎ»Î¿"],
};

function norm(s){
  return (s||"").toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"");
}
function hasAny(text, arr){
  const t = norm(text);
  return arr.some(k => t.includes(norm(k)));
}
function countHits(text, families){
  let hits = {};
  for(const [k, arr] of Object.entries(families)){
    hits[k] = hasAny(text, arr);
  }
  return hits;
}

function buildScenario(state){
  // Simple deterministic scenario narrative
  const n = state.n;
  const age = state.age;
  const space = state.space;
  const equip = state.equip;
  const goal = state.goal;
  const c = state.constraints;

  const ageTxt = (age==="primary") ? "Î”Î·Î¼Î¿Ï„Î¹ÎºÏŒ" : (age==="gymnasium") ? "Î“Ï…Î¼Î½Î¬ÏƒÎ¹Î¿" : "Î›ÏÎºÎµÎ¹Î¿";
  const spaceTxt = ({
    open_big:"Î¼ÎµÎ³Î¬Î»Î¿ Î±Î½Î¿Î¹Ï‡Ï„ÏŒ Ï€ÏÎ¿Î±ÏÎ»Î¹Î¿",
    open_small:"Î¼Î¹ÎºÏÏŒ Î±Î½Î¿Î¹Ï‡Ï„ÏŒ Ï€ÏÎ¿Î±ÏÎ»Î¹Î¿",
    corridor:"ÏƒÏ„ÎµÎ½Î® Î¶ÏÎ½Î·/Î´Î¹Î¬Î´ÏÎ¿Î¼Î¿Ï‚",
    zoned:"Ï‡ÏÏÎ¿Ï‚ Ï‡Ï‰ÏÎ¹ÏƒÎ¼Î­Î½Î¿Ï‚ ÏƒÎµ 2â€“3 Î¶ÏÎ½ÎµÏ‚"
  })[space];

  const equipTxt = ({
    none:"Ï‡Ï‰ÏÎ¯Ï‚ ÎµÎ¾Î¿Ï€Î»Î¹ÏƒÎ¼ÏŒ",
    one_ball:"1 Î¼Ï€Î¬Î»Î±",
    two_balls:"2 Î¼Ï€Î¬Î»ÎµÏ‚",
    cones:"ÎºÏÎ½Î¿Î¹/ÏƒÎ·Î¼Î¬Î´Î¹Î±"
  })[equip];

  const consTxt = c.length ? c.map(x => ({
    no_running:"Ï‡Ï‰ÏÎ¯Ï‚ Ï„ÏÎ­Î¾Î¹Î¼Î¿",
    no_talking:"Ï‡Ï‰ÏÎ¯Ï‚ Î¿Î¼Î¹Î»Î¯Î±",
    no_elimination:"Ï‡Ï‰ÏÎ¯Ï‚ Î±Ï€Î¿ÎºÎ»ÎµÎ¹ÏƒÎ¼ÏŒ",
    arrive_together:"Î½Î± Ï†Ï„Î¬ÏƒÎ¿Ï…Î½ ÏŒÎ»Î¿Î¹ Î¼Î±Î¶Î¯",
    no_leader:"Ï‡Ï‰ÏÎ¯Ï‚ Î±ÏÏ‡Î·Î³ÏŒ"
  })[x]).join(", ") : "ÎºÎ±Î½Î­Î½Î±Î½ ÎµÎ¹Î´Î¹ÎºÏŒ Ï€ÎµÏÎ¹Î¿ÏÎ¹ÏƒÎ¼ÏŒ";

  // Axis-specific question prompt
  let prompt = "";
  if(state.axis==="m1"){
    prompt = `Î•ÏÏÏ„Î·ÏƒÎ·: Î”Î¹Î±Ï„ÏÏ€Ï‰ÏƒÎµ Ï„Î¿ <b>ÎºÎ¹Î½Î·Ï„Î¹ÎºÏŒ Ï€ÏÏŒÎ²Î»Î·Î¼Î±</b> Î¼Îµ 1â€“2 Ï€ÏÎ¿Ï„Î¬ÏƒÎµÎ¹Ï‚ (ÏƒÎ±Î½ ÎµÏÏÏ„Î·Î¼Î±). Î¤Î¹ ÎºÎ±Î»Î¿ÏÎ½Ï„Î±Î¹ Î½Î± â€œÎ»ÏÏƒÎ¿Ï…Î½â€ Î¼Îµ Ï„Î¿ ÏƒÏÎ¼Î± Ï„Î¿Ï…Ï‚;`;
  } else if(state.axis==="m2"){
    prompt = `Î•ÏÏÏ„Î·ÏƒÎ·: ÎšÎ¬Î½Îµ <b>Ï€ÏÏŒÎ²Î»ÎµÏˆÎ· ÏƒÏ…Î¼Ï€ÎµÏÎ¹Ï†Î¿ÏÎ¬Ï‚</b>. Î¤Î¹ ÎµÎ¯Î½Î±Î¹ Ï€Î¹Î¸Î±Î½ÏŒ Î½Î± ÏƒÏ…Î¼Î²ÎµÎ¯ ÏƒÎµ Î±Ï…Ï„ÏŒÎ½ Ï„Î¿Î½ Ï‡ÏÏÎ¿, Î¼Îµ Î±Ï…Ï„Î¬ Ï„Î± Ï€Î±Î¹Î´Î¹Î¬/ÎµÎ¾Î¿Ï€Î»Î¹ÏƒÎ¼ÏŒ, Î±Î½ Î¾ÎµÎºÎ¹Î½Î®ÏƒÎµÎ¹ Î· Î´ÏÎ±ÏƒÏ„Î·ÏÎ¹ÏŒÏ„Î·Ï„Î±;`;
  } else {
    prompt = `Î•ÏÏÏ„Î·ÏƒÎ·: Î ÏÏŒÏ„ÎµÎ¹Î½Îµ <b>Î­Î½Î±Î½ ÎºÎ±Î½ÏŒÎ½Î±/Ï€Î±ÏÎ­Î¼Î²Î±ÏƒÎ·</b> Ï€Î¿Ï… Î¿ÏÎ³Î±Î½ÏÎ½ÎµÎ¹ Ï„Î·Î½ Î¿Î¼Î¬Î´Î± Ï‡Ï‰ÏÎ¯Ï‚ Î½Î± Î±Ï€Î¿ÎºÎ»ÎµÎ¯ÎµÎ¹ Ï€Î±Î¹Î´Î¹Î¬. Î•Î¾Î®Î³Î·ÏƒÎµ Î³Î¹Î±Ï„Î¯ Î¸Î± Î²Î¿Î·Î¸Î®ÏƒÎµÎ¹.`;
  }

  return `
    <div class="muted">
      <span class="tag mono">${state.axis.toUpperCase()}</span>
      <span class="tag mono">${ageTxt}</span>
      <span class="tag mono">${n} Î¼Î±Î¸Î·Ï„Î­Ï‚</span>
      <span class="tag mono">${equipTxt}</span>
      <span class="tag mono">${spaceTxt}</span>
    </div>
    <div style="margin-top:10px; line-height:1.45;">
      <b>Î£ÎµÎ½Î¬ÏÎ¹Î¿:</b> ÎˆÏ‡ÎµÎ¹Ï‚ ${n} Î¼Î±Î¸Î·Ï„Î­Ï‚ (${ageTxt}) ÏƒÎµ ${spaceTxt}, ${equipTxt}. Î£Ï„ÏŒÏ‡Î¿Ï‚: <b>${goal}</b>.
      Î ÎµÏÎ¹Î¿ÏÎ¹ÏƒÎ¼Î¿Î¯: <b>${consTxt}</b>.
    </div>
    <div style="margin-top:10px;">${prompt}</div>
  `;
}

function rubricForAxis(axis){
  // Each criterion is 0/1/2 with deterministic checks
  if(axis==="m1"){
    return [
      {name:"Î©Ï‚ ÎµÏÏÏ„Î·Î¼Î± (problem framing)", max:2,
       check:(t,h)=> (hasAny(t, KEY.taskAsQuestion) ? 2 : 0),
       tip:"Î”Î¹Î±Ï„ÏÏ€Ï‰ÏƒÎ­ Ï„Î¿ ÏƒÎ±Î½ ÎµÏÏÏ„Î·Î¼Î±: Â«Î ÏÏ‚ Î¼Ï€Î¿ÏÎ¿ÏÎ½â€¦;Â»"},
      {name:"Î‘Î½Î±Ï†Î¿ÏÎ¬ ÏƒÎµ Ï€ÎµÏÎ¹Î¿ÏÎ¹ÏƒÎ¼Î¿ÏÏ‚/ÏƒÏ„ÏŒÏ‡Î¿", max:2,
       check:(t,h)=> (hasAny(t, KEY.constraints) || t.includes("Ï‡Ï‰ÏÎ¯Ï‚") ? 2 : 0),
       tip:"Î’Î¬Î»Îµ Ï„Î¿Ï…Ï‚ Î²Î±ÏƒÎ¹ÎºÎ¿ÏÏ‚ Ï€ÎµÏÎ¹Î¿ÏÎ¹ÏƒÎ¼Î¿ÏÏ‚ Î® Ï„Î¿Î½ ÏƒÏ„ÏŒÏ‡Î¿ Î¼Î­ÏƒÎ± ÏƒÏ„Î· Î´Î¹Î±Ï„ÏÏ€Ï‰ÏƒÎ·."},
      {name:"ÎŒÏ‡Î¹ â€˜Î¬ÏƒÎºÎ·ÏƒÎ·â€™, Î±Î»Î»Î¬ â€˜Ï€ÏÏŒÎ²Î»Î·Î¼Î±â€™", max:2,
       check:(t,h)=> (t.includes("Î½Î± Î»ÏÏƒÎ¿Ï…Î½") || t.includes("Ï€ÏÏŒÎ²Î»Î·Î¼Î±") ? 2 : 1),
       tip:"ÎœÎ·Î½ Ï€ÎµÏÎ¹Î³ÏÎ¬Ï†ÎµÎ¹Ï‚ Î´ÏÎ±ÏƒÏ„Î·ÏÎ¹ÏŒÏ„Î·Ï„Î± Ï„ÏÏ€Î¿Ï… Â«Ï€Î±Î¯Î¶Î¿Ï…Î¼Îµâ€¦Â». Î ÎµÏÎ¹Î­Î³ÏÎ±ÏˆÎµ Ï„Î¹ Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± Î»Ï…Î¸ÎµÎ¯."},
      {name:"Î£Î±Ï†Î®Î½ÎµÎ¹Î± (1â€“2 Ï€ÏÎ¿Ï„Î¬ÏƒÎµÎ¹Ï‚)", max:2,
       check:(t,h)=> (t.length < 260 ? 2 : 1),
       tip:"ÎšÏÎ¬Ï„Î± Ï„Î¿ ÏƒÏÎ½Ï„Î¿Î¼Î¿ ÎºÎ±Î¹ ÎºÎ±Î¸Î±ÏÏŒ."},
      {name:"Î‘Ï€Î¿Ï†ÎµÏÎ³ÎµÎ¹ Î±Î¾Î¹Î¿Î»Î¿Î³Î¹ÎºÎ¿ÏÏ‚ ÏŒÏÎ¿Ï…Ï‚", max:2,
       check:(t,h)=> (t.includes("ÏƒÏ‰ÏƒÏ„ÏŒ") || t.includes("Î»Î¬Î¸Î¿Ï‚") ? 0 : 2),
       tip:"ÎœÎ· Î¼Î¹Î»Î¬Ï‚ Î³Î¹Î± Â«ÏƒÏ‰ÏƒÏ„ÏŒ/Î»Î¬Î¸Î¿Ï‚Â» â€” Î¼Î¹Î»Î¬Ï‚ Î³Î¹Î± Î»ÏÏƒÎµÎ¹Ï‚."},
    ];
  }

  if(axis==="m2"){
    return [
      {name:"Î£ÏÎ½Î´ÎµÏƒÎ· Ï‡ÏÏÎ¿Ï… â†’ ÏƒÏ…Î¼Ï€ÎµÏÎ¹Ï†Î¿ÏÎ¬", max:2,
       check:(t,h)=> (hasAny(t, KEY.proposeSpaceChange) || hasAny(t, KEY.constraints) ? 2 : 1),
       tip:"Î”ÎµÎ¯Î¾Îµ ÏŒÏ„Î¹ ÎºÎ±Ï„Î±Î»Î±Î²Î±Î¯Î½ÎµÎ¹Ï‚ Ï€Ï‰Ï‚ Î¿ Ï‡ÏÏÎ¿Ï‚/ÏÎ¿Î­Ï‚/ÏŒÏÎ¹Î± Ï€Î±ÏÎ¬Î³Î¿Ï…Î½ ÏƒÏ…Î¼Ï€ÎµÏÎ¹Ï†Î¿ÏÎ¬."},
      {name:"Î‘Î½Î±Î³Î½ÏÏÎ¹ÏƒÎ· dominance / Ï€ÎµÏÎ¹Î¸Ï‰ÏÎ¯Î¿Ï…", max:2,
       check:(t,h)=> ((h.dominance && h.periphery) ? 2 : (h.dominance || h.periphery) ? 1 : 0),
       tip:"Î Î¿Î¹Î¿Î¹ Î¸Î± ÎºÏ…ÏÎ¹Î±ÏÏ‡Î®ÏƒÎ¿Ï…Î½; Î Î¿Î¹Î¿Î¹ Î¸Î± Ï‡Î±Î¸Î¿ÏÎ½;"},
      {name:"Î‘Î½Î±Î³Î½ÏÏÎ¹ÏƒÎ· ÏÎ¯ÏƒÎºÎ¿Ï…/Î±ÏƒÏ†Î¬Î»ÎµÎ¹Î±Ï‚", max:2,
       check:(t,h)=> (h.collisions ? 2 : 0),
       tip:"Î£Îµ Î±Î½Î¿Î¹Ï‡Ï„ÏŒ Ï‡ÏÏÎ¿ + Î¼Ï€Î¬Î»Î± + Ï€Î¿Î»Î»Î¿Î¯ Î¼Î±Î¸Î·Ï„Î­Ï‚, ÏƒÏ…Ï‡Î½Î¬ ÎµÎ¼Ï†Î±Î½Î¯Î¶Î¿Î½Ï„Î±Î¹ Ï„Î±Ï‡ÏÏ„Î·Ï„Î±/ÏƒÏ…Î³ÎºÏÎ¿ÏÏƒÎµÎ¹Ï‚."},
      {name:"Î ÎµÏÎ¹Î³ÏÎ¬Ï†ÎµÎ¹ Ï€Î¹Î¸Î±Î½Î¬ Î¼Î¿Ï„Î¯Î²Î±, ÏŒÏ‡Î¹ Î»ÏÏƒÎµÎ¹Ï‚", max:2,
       check:(t,h)=> (t.includes("Î¸Î±") ? 2 : 1),
       tip:"ÎœÎ¯Î»Î± Î³Î¹Î± Ï€Î¹Î¸Î±Î½ÏŒÏ„Î·Ï„ÎµÏ‚: Â«ÎµÎ¯Î½Î±Î¹ Ï€Î¹Î¸Î±Î½ÏŒ Î½Î±â€¦Â»"},
      {name:"Î‘Ï€Î¿Ï†ÎµÏÎ³ÎµÎ¹ Î±Ï€Î¿ÎºÎ»ÎµÎ¹ÏƒÎ¼ÏŒ/Ï„Î¹Î¼Ï‰ÏÎ¯Î±", max:2,
       check:(t,h)=> (h.elimBad ? 0 : 2),
       tip:"ÎœÎ·Î½ Ï€ÏÎ¿Ï„ÎµÎ¯Î½ÎµÎ¹Ï‚ â€˜Î²Î³Î±Î¯Î½ÎµÎ¹ Î­Î¾Ï‰â€™ Ï‰Ï‚ Î¼Î·Ï‡Î±Î½Î¹ÏƒÎ¼ÏŒ."},
    ];
  }

  // m3
  return [
    {name:"Î ÏÎ¿Ï„ÎµÎ¯Î½ÎµÎ¹ 1 ÏƒÎ±Ï†Î® ÎºÎ±Î½ÏŒÎ½Î±", max:2,
     check:(t,h)=> (h.proposeRule ? 2 : 0),
     tip:"Î”ÏÏƒÎµ Î­Î½Î±Î½ ÎºÎ±Î½ÏŒÎ½Î± Ï„ÏÏ€Î¿Ï… Â«Î´ÎµÎ½ Î¼Ï€Î¿ÏÎµÎ¯Ï‚â€¦Â» / Â«Î±Î»Î»Î¬Î¶ÎµÎ¹ ÏÏŒÎ»Î¿ ÏŒÏ„Î±Î½â€¦Â»"},
    {name:"ÎŸ ÎºÎ±Î½ÏŒÎ½Î±Ï‚ Î¿ÏÎ³Î±Î½ÏÎ½ÎµÎ¹ ÏƒÏ…Î¼Î¼ÎµÏ„Î¿Ï‡Î®", max:2,
     check:(t,h)=> (h.noElim || !h.elimBad ? 2 : 0),
     tip:"ÎŸ ÎºÎ±Î½ÏŒÎ½Î±Ï‚ Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± ÎºÏÎ±Ï„Î¬ ÏŒÎ»Î¿Ï…Ï‚ Î¼Î­ÏƒÎ±."},
    {name:"Î£Ï„ÏŒÏ‡ÎµÏ…ÏƒÎ· ÏÏŒÎ»Ï‰Î½/ÎºÏ…ÏÎ¹Î±ÏÏ‡Î¯Î±Ï‚", max:2,
     check:(t,h)=> ((h.dominance || h.periphery) ? 2 : 1),
     tip:"Î”ÎµÎ¯Î¾Îµ ÏŒÏ„Î¹ ÎºÎ±Ï„Î±Î»Î±Î²Î±Î¯Î½ÎµÎ¹Ï‚ Ï€Î¿Î¹Î¿ Î¼Î¿Ï„Î¯Î²Î¿ Î¸ÎµÏ‚ Î½Î± Î´Î¹Î¿ÏÎ¸ÏÏƒÎµÎ¹Ï‚ (ÎºÏ…ÏÎ¹Î±ÏÏ‡Î¯Î±/Ï€ÎµÏÎ¹Î¸ÏÏÎ¹Î¿)."},
    {name:"Î‘Î¹Ï„Î¹Î¿Î»ÏŒÎ³Î·ÏƒÎ·: Î³Î¹Î±Ï„Î¯ Î¸Î± Î´Î¿Ï…Î»Î­ÏˆÎµÎ¹", max:2,
     check:(t,h)=> (t.includes("Î³Î¹Î±Ï„Î¯") || t.includes("ÏÏƒÏ„Îµ") ? 2 : 1),
     tip:"ÎœÎ¹Î± Ï€ÏÏŒÏ„Î±ÏƒÎ· Î±Î¹Ï„Î¹Î¿Î»ÏŒÎ³Î·ÏƒÎ·Ï‚ Î±ÏÎºÎµÎ¯."},
    {name:"Î‘Ï€Î¿Ï†ÎµÏÎ³ÎµÎ¹ Ï„Î¹Î¼Ï‰ÏÎ·Ï„Î¹ÎºÎ¿ÏÏ‚ Î¼Î·Ï‡Î±Î½Î¹ÏƒÎ¼Î¿ÏÏ‚", max:2,
     check:(t,h)=> (h.elimBad ? 0 : 2),
     tip:"Î‘Ï€Î­Ï†Ï…Î³Îµ â€˜ÏŒÏ€Î¿Î¹Î¿Ï‚ ÎºÎ¬Î½ÎµÎ¹ Î»Î¬Î¸Î¿Ï‚ Î²Î³Î±Î¯Î½ÎµÎ¹â€™."},
  ];
}

function grade(axis, answer){
  const t = norm(answer);
  const hits = countHits(t, KEY);
  const rubric = rubricForAxis(axis);
  let total=0, max=0;
  const breakdown = rubric.map(r=>{
    const s = r.check(t, hits);
    total += s; max += r.max;
    return {name:r.name, score:s, max:r.max, tip:r.tip};
  });

  // label
  const pct = Math.round((total/max)*100);
  let label = (pct>=80) ? {txt:"Î™ÏƒÏ‡Ï…ÏÏŒ", cls:"ok"} : (pct>=55) ? {txt:"ÎšÎ±Î»ÏŒ/ÎœÎ­Ï„ÏÎ¹Î¿", cls:"warn"} : {txt:"Î‘Î½ÎµÏ€Î±ÏÎºÎ­Ï‚", cls:"bad"};

  // assistant style feedback (template)
  const strengths = [];
  const gaps = [];
  breakdown.forEach(b=>{
    if(b.score === b.max) strengths.push(b.name);
    else gaps.push(b);
  });

  const assistant = buildAssistantFeedback(axis, hits, strengths, gaps, pct);

  return {total, max, pct, label, breakdown, assistant};
}

function buildAssistantFeedback(axis, hits, strengths, gaps, pct){
  const axisName = axis==="m1" ? "ÎšÎ¹Î½Î·Ï„Î¹ÎºÏŒ Î ÏÏŒÎ²Î»Î·Î¼Î±" : axis==="m2" ? "Î§ÏÏÎ¿Ï‚ Ï‰Ï‚ Î£ÏÏƒÏ„Î·Î¼Î±" : "ÎšÎ±Î½ÏŒÎ½ÎµÏ‚ & Î¡ÏŒÎ»Î¿Î¹";

  const s1 = strengths.length
    ? `âœ… Î¤Î¹ Î­ÎºÎ±Î½ÎµÏ‚ ÎºÎ±Î»Î¬ (${axisName}): <ul class="list">${strengths.map(x=>`<li>${x}</li>`).join("")}</ul>`
    : `âœ… Î£Î·Î¼ÎµÎ¯Î¿ ÎµÎºÎºÎ¯Î½Î·ÏƒÎ·Ï‚: Î­Ï‡ÎµÎ¹Ï‚ Î²Î¬ÏƒÎ·, Î±Î»Î»Î¬ Î»ÎµÎ¯Ï€Î¿Ï…Î½ ÏÎ·Ï„Î¬ ÏƒÏ„Î¿Î¹Ï‡ÎµÎ¯Î± Î³Î¹Î± Î½Î± â€œÎ´Î­ÏƒÎµÎ¹â€ Î· Î±Ï€Î¬Î½Ï„Î·ÏƒÎ·.`;

  const g1 = gaps.length
    ? `ğŸ”§ Î¤Î¹ Î½Î± Î²ÎµÎ»Ï„Î¹ÏÏƒÎµÎ¹Ï‚ (2 ÎºÎ¹Î½Î®ÏƒÎµÎ¹Ï‚): <ul class="list">${
        gaps.slice(0,2).map(g=>`<li><b>${g.name}:</b> ${g.tip}</li>`).join("")
      }</ul>`
    : `ğŸ”§ ÎœÎ¹ÎºÏÎ® Î²ÎµÎ»Ï„Î¯Ï‰ÏƒÎ·: ÎºÎ¬Î½â€™ Ï„Î¿ Î»Î¯Î³Î¿ Ï€Î¹Î¿ ÏƒÏ…Î³ÎºÎµÎºÏÎ¹Î¼Î­Î½Î¿ (Î­Î½Î± Ï€Î±ÏÎ¬Î´ÎµÎ¹Î³Î¼Î±/Î¼Î¹Î± Ï†ÏÎ¬ÏƒÎ·).`;

  // axis-specific hints
  let hint = "";
  if(axis==="m1"){
    hint = `Hint: Î³ÏÎ¬ÏˆÎµ Ï„Î¿ ÏƒÎ±Î½ Â«Î ÏÏ‚ Î¼Ï€Î¿ÏÎ¿ÏÎ½ Î¿Î¹ Î¼Î±Î¸Î·Ï„Î­Ï‚ Î½Î± â€¦ <i>Ï…Ï€ÏŒ Î±Ï…Ï„Î¿ÏÏ‚ Ï„Î¿Ï…Ï‚ Ï€ÎµÏÎ¹Î¿ÏÎ¹ÏƒÎ¼Î¿ÏÏ‚</i>;Â»`;
  } else if(axis==="m2"){
    hint = `Hint: Î¾ÎµÎºÎ¯Î½Î± Î¼Îµ Â«Î£Îµ Î±Ï…Ï„ÏŒÎ½ Ï„Î¿Î½ Ï‡ÏÏÎ¿ ÎµÎ¯Î½Î±Î¹ Ï€Î¹Î¸Î±Î½ÏŒ Î½Î± ÎµÎ¼Ï†Î±Î½Î¹ÏƒÏ„ÎµÎ¯â€¦Â» ÎºÎ±Î¹ ÏƒÏÎ½Î´ÎµÏƒÎµ Ï‡ÏÏÎ¿â†’ÏƒÏ…Î¼Ï€ÎµÏÎ¹Ï†Î¿ÏÎ¬.`;
  } else {
    hint = `Hint: Ï€ÏÏŒÏ„ÎµÎ¹Î½Îµ Î­Î½Î±Î½ ÎºÎ±Î½ÏŒÎ½Î± Ï€Î¿Ï… Î±Î»Î»Î¬Î¶ÎµÎ¹ ÏÏŒÎ»Î¿Ï…Ï‚/ÏÎ¿Î®, Ï‡Ï‰ÏÎ¯Ï‚ â€œÎ²Î³Î±Î¯Î½ÎµÎ¹ Î­Î¾Ï‰â€.`;
  }

  return `
    <div class="muted">
      <span class="tag mono">${axis.toUpperCase()}</span>
      <span class="tag mono">score=${pct}%</span>
      <span class="tag mono">${axisName}</span>
    </div>
    <div style="margin-top:10px;">
      ${s1}
      <div class="hr"></div>
      ${g1}
      <div class="hr"></div>
      <div class="small">${hint}</div>
    </div>
  `;
}

function showRubric(axis){
  const rubric = rubricForAxis(axis);
  return `
    <div class="muted"><b>Rubric (${axis.toUpperCase()})</b></div>
    <ul class="list">
      ${rubric.map(r=>`<li><span class="mono">${r.max}pt</span> â€” ${r.name} <span class="small">(${r.tip})</span></li>`).join("")}
    </ul>
    <div class="small">Î£Î·Î¼ÎµÎ¯Ï‰ÏƒÎ·: Î¤Î¿ rubric ÎµÎ¯Î½Î±Î¹ Î· â€œÏ€Î·Î³Î® Î±Î»Î®Î¸ÎµÎ¹Î±Ï‚â€. Î¤Î¿ feedback ÎµÎ¯Î½Î±Î¹ Î±Ï€Î»ÏÏ‚ ÎµÏ€ÎµÎ¾Î·Î³Î·Î¼Î±Ï„Î¹ÎºÏŒ.</div>
  `;
}

function randomHint(axis, state){
  if(axis==="m1"){
    return `Î”Î¿ÎºÎ¯Î¼Î±ÏƒÎµ: Â«Î ÏÏ‚ Î¼Ï€Î¿ÏÎ¿ÏÎ½ ${state.n} Î¼Î±Î¸Î·Ï„Î­Ï‚ Î½Î± Ï€ÎµÏ„ÏÏ‡Î¿Ï…Î½ Ï„Î¿Î½ ÏƒÏ„ÏŒÏ‡Î¿ (${state.goal}) Î¼Îµ Ï€ÎµÏÎ¹Î¿ÏÎ¹ÏƒÎ¼Î¿ÏÏ‚ (${state.constraints.length || "ÎºÎ±Î½Î­Î½Î±Î½"}) Ï‡Ï‰ÏÎ¯Ï‚ Î½Î± Ï„Î¿Ï…Ï‚ Î´ÎµÎ¯Î¾Ï‰ Î»ÏÏƒÎ·;Â»`;
  }
  if(axis==="m2"){
    return `Î”Î¿ÎºÎ¯Î¼Î±ÏƒÎµ Î½Î± Ï€ÏÎ¿Î²Î»Î­ÏˆÎµÎ¹Ï‚: (Î±) Ï€Î¿Î¹Î¿Ï‚ Î¸Î± ÎºÏ…ÏÎ¹Î±ÏÏ‡Î®ÏƒÎµÎ¹, (Î²) Ï€Î¿Î¹Î¿Ï‚ Î¸Î± Î±Ï€Î¿ÏƒÏ…ÏÎ¸ÎµÎ¯, (Î³) Ï€Î¿Î¹Î¿ ÏÎ¯ÏƒÎºÎ¿ Ï€ÏÎ¿ÎºÏÏ€Ï„ÎµÎ¹ (Ï€.Ï‡. Ï„Î±Ï‡ÏÏ„Î·Ï„Î±/ÏƒÏ…Î³ÎºÏÎ¿ÏÏƒÎµÎ¹Ï‚).`;
  }
  return `Î”Î¿ÎºÎ¯Î¼Î±ÏƒÎµ ÎºÎ±Î½ÏŒÎ½Î± â€œÎµÎ½Î±Î»Î»Î±Î³Î®Ï‚ ÏÏŒÎ»Ï‰Î½â€: Â«Î¼ÏŒÎ»Î¹Ï‚ ÏƒÏ…Î¼Î²ÎµÎ¯ Î§, Î±Î»Î»Î¬Î¶ÎµÎ¹Ï‚ ÏÏŒÎ»Î¿Â» Î® ÎºÎ±Î½ÏŒÎ½Î± â€œÎ´Î¹Î±ÏƒÏ€Î¿ÏÎ¬Ï‚â€: Â«Î´ÎµÎ½ Î¼Ï€Î¿ÏÎµÎ¯Ï‚ Î½Î± ÏƒÏ„Î¿Ï‡ÎµÏÏƒÎµÎ¹Ï‚ Ï„Î¿ Î¯Î´Î¹Î¿ Î¬Ï„Î¿Î¼Î¿ 2 Ï†Î¿ÏÎ­Ï‚Â».`;
}

// UI state
let STATE = null;

function getStateFromUI(){
  const axis = $("axisSel").value;
  const age = $("ageSel").value;
  const n = parseInt($("nInput").value || "22", 10);
  const space = $("spaceSel").value;
  const equip = $("equipSel").value;
  const goal = $("goalInput").value.trim() || "ÏƒÏ…Î½ÎµÏÎ³Î±ÏƒÎ¯Î±";
  const constraints = Array.from($("constraintSel").selectedOptions).map(o=>o.value);

  return {axis, age, n, space, equip, goal, constraints};
}

function setScenario(){
  STATE = getStateFromUI();
  $("scenarioBox").innerHTML = buildScenario(STATE);
  $("feedbackBox").innerHTML = `<div class="muted">Î“ÏÎ¬ÏˆÎµ Î±Ï€Î¬Î½Ï„Î·ÏƒÎ· ÎºÎ±Î¹ Ï€Î¬Ï„Î± <b>Î’Î±Î¸Î¼Î¿Î»ÏŒÎ³Î·ÏƒÎ·</b>.</div>`;
  $("kpiBox").innerHTML = `
    <span class="pill">Î†Î¾Î¿Î½Î±Ï‚: <b>${STATE.axis.toUpperCase()}</b></span>
    <span class="pill">Constraints: <b>${STATE.constraints.length}</b></span>
    <span class="pill">Mode: <b class="mono">LLM-free</b></span>
  `;
}

function resetAll(){
  $("answerTA").value = "";
  setScenario();
}

$("newBtn").addEventListener("click", ()=> setScenario());
$("resetBtn").addEventListener("click", ()=> resetAll());

$("hintBtn").addEventListener("click", ()=>{
  if(!STATE) setScenario();
  const h = randomHint(STATE.axis, STATE);
  $("feedbackBox").innerHTML = `<div class="muted"><b>Hint:</b> ${h}</div>`;
});

$("showRubricBtn").addEventListener("click", ()=>{
  if(!STATE) setScenario();
  $("feedbackBox").innerHTML = showRubric(STATE.axis);
});

$("gradeBtn").addEventListener("click", ()=>{
  if(!STATE) setScenario();
  const ans = $("answerTA").value || "";
  const res = grade(STATE.axis, ans);

  $("kpiBox").innerHTML = `
    <span class="pill">Î£ÎºÎ¿Ï: <b class="score ${res.label.cls}">${res.pct}%</b></span>
    <span class="pill">Î•Ï€Î¯Ï€ÎµÎ´Î¿: <b class="${res.label.cls}">${res.label.txt}</b></span>
    <span class="pill">Î£ÏÎ½Î¿Î»Î¿: <b class="mono">${res.total}/${res.max}</b></span>
  `;

  const breakdownHtml = `
    <div class="muted"><b>Î‘Î½Î¬Î»Ï…ÏƒÎ· Î²Î±Î¸Î¼Î¿Î»ÏŒÎ³Î·ÏƒÎ·Ï‚</b></div>
    <ul class="list">
      ${res.breakdown.map(b=>`<li>${b.name}: <span class="mono">${b.score}/${b.max}</span></li>`).join("")}
    </ul>
  `;

  $("feedbackBox").innerHTML = res.assistant + `<div class="hr"></div>` + breakdownHtml;
});

// init
setScenario();
</script>
</body>
</html>